// Shared utility functions for shift calculations, validations, and manipulations 